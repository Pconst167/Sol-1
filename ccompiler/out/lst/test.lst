0001   0000             ; --- FILENAME: test
0002   0000             .include "lib/asm/kernel.exp"
0001+  0000             text_org    .EQU  $0400
0002+  0000             sys_bkpt         .EQU  $0000
0003+  0000             sys_rtc          .EQU  $0001
0004+  0000             sys_ide          .EQU  $0002
0005+  0000             sys_io           .EQU  $0003
0006+  0000             sys_filesystem   .EQU  $0004
0007+  0000             sys_spawn_proc   .EQU  $0005
0008+  0000             sys_list         .EQU  $0006
0009+  0000             sys_datetime     .EQU  $0007
0010+  0000             sys_reboot       .EQU  $0008
0011+  0000             sys_pause_proc   .EQU  $0009
0012+  0000             sys_resume_proc  .EQU  $000a
0013+  0000             sys_terminate_proc .EQU  $000b
0014+  0000             sys_system       .EQU  $000c
0015+  0000             sys_boot_install .EQU  $000d
0003   0000             .include "lib/asm/bios.exp"
0001+  0000             BIOS_RESET_VECTOR .EQU  $01c0
0002+  0000             IDE_buffer       .EQU  $8204
0003+  0000             boot_origin      .EQU  $8004
0004+  0000             bios_uart        .EQU  $0002
0005+  0000             bios_ide         .EQU  $0003
0004   0400             .org text_org
0005   0400             
0006   0400             ; --- BEGIN TEXT BLOCK
0007   0400             main:
0008   0400 FD 49 E0 FF   mov bp, $FFE0 ;
0009   0404 FD 47 E0 FF   mov sp, $FFE0 ; Make space for argc(2 bytes) and for 10 pointers in argv (local variables)
0010   0408             ;; a = 65536L; 
0011   0408 3B 32 04      mov d, _a ; $a
0012   040B DA            push d
0013   040C 26 00 00      mov b, $0
0014   040F 38 01 00      mov c, $1
0015   0412 E7            pop d
0016   0413 FD 43         mov [d], b
0017   0415 28            mov b, c
0018   0416 FD 44 02 00   mov [d + 2], b
0019   041A             ;; p = &a; 
0020   041A 3B 3E 04      mov d, _p ; $p
0021   041D DA            push d
0022   041E 3B 32 04      mov d, _a ; $a
0023   0421 2D            mov b, d
0024   0422 E7            pop d
0025   0423 FD 43         mov [d], b
0026   0425             ;; *p; 
0027   0425 3B 3E 04      mov d, _p ; $p
0028   0428 2A            mov b, [d]
0029   0429 74            mov d, b
0030   042A 2B 02 00      mov b, [d + 2]
0031   042D FD 39         mov c, b
0032   042F 2A            mov b, [d]
0033   0430 05 0B         syscall sys_terminate_proc
0034   0432             ; --- END TEXT BLOCK
0035   0432             
0036   0432             ; --- BEGIN DATA BLOCK
0037   0432 00 00 00 00 _a: .fill 4, 0
0038   0436 00 00 00 00 _b: .fill 4, 0
0039   043A 00 00 00 00 _c: .fill 4, 0
0040   043E 00 00       _p: .fill 2, 0
0041   0440             
0042   0440 42 04       _heap_top: .dw _heap
0043   0442 00          _heap: .db 0
0044   0443             ; --- END DATA BLOCK
0045   0443             
0046   0443             .end
tasm: Number of errors = 0
