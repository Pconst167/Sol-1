0001   0000             ; --- FILENAME: test
0002   0000             .include "lib/kernel.exp"
0001+  0000             text_org    .EQU  $0400
0002+  0000             sys_bkpt         .EQU  $0000
0003+  0000             sys_rtc          .EQU  $0001
0004+  0000             sys_ide          .EQU  $0002
0005+  0000             sys_io           .EQU  $0003
0006+  0000             sys_filesystem   .EQU  $0004
0007+  0000             sys_spawn_proc   .EQU  $0005
0008+  0000             sys_list         .EQU  $0006
0009+  0000             sys_datetime     .EQU  $0007
0010+  0000             sys_reboot       .EQU  $0008
0011+  0000             sys_pause_proc   .EQU  $0009
0012+  0000             sys_resume_proc  .EQU  $000a
0013+  0000             sys_terminate_proc .EQU  $000b
0014+  0000             sys_system       .EQU  $000c
0015+  0000             sys_boot_install .EQU  $000d
0003   0000             .include "lib/bios.exp"
0001+  0000             BIOS_RESET_VECTOR .EQU  $01c0
0002+  0000             IDE_buffer       .EQU  $8204
0003+  0000             boot_origin      .EQU  $8004
0004+  0000             bios_uart        .EQU  $0002
0005+  0000             bios_ide         .EQU  $0003
0004   0400             .org text_org
0005   0400             
0006   0400             ; --- BEGIN TEXT BLOCK
0007   0400             main:
0008   0400 FD 49 E0 FF   mov bp, $FFE0 ;
0009   0404 FD 47 E0 FF   mov sp, $FFE0 ; Make space for argc(2 bytes) and for 10 pointers in argv (local variables)
0010   0408             ;; myfunc(1, 2, 'a', 255, 65535, 'b'); 
0011   0408 26 61 00      mov b, $61
0012   040B FD AB         swp b
0013   040D D8            push b
0014   040E 26 FF 00      mov b, $ff
0015   0411 FD AB         swp b
0016   0413 D8            push b
0017   0414 26 FF FF      mov b, $ffff
0018   0417 FD AB         swp b
0019   0419 D8            push b
0020   041A 26 62 00      mov b, $62
0021   041D FD AB         swp b
0022   041F D8            push b
0023   0420 26 01 00      mov b, $1
0024   0423 FD AB         swp b
0025   0425 D8            push b
0026   0426 26 02 00      mov b, $2
0027   0429 FD AB         swp b
0028   042B D8            push b
0029   042C 07 38 04      call myfunc
0030   042F 51 0C 00      add sp, 12
0031   0432             ;; return 0; 
0032   0432 26 00 00      mov b, $0
0033   0435 F9            leave
0034   0436 05 0B         syscall sys_terminate_proc
0035   0438             
0036   0438             myfunc:
0037   0438 F8 00 00      enter 0 ; (push bp; mov bp, sp)
0038   043B F9            leave
0039   043C 09            ret
0040   043D             ; --- END TEXT BLOCK
0041   043D             
0042   043D             ; --- BEGIN DATA BLOCK
0043   043D             
0044   043D 3F 04       _heap_top: .dw _heap
0045   043F 00          _heap: .db 0
0046   0440             ; --- END DATA BLOCK
0047   0440             
0048   0440             .end
tasm: Number of errors = 0
